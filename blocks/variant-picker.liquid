{% liquid
  assign product_resource = closest.product
  if request.visual_preview_mode and product_resource == blank
    assign product_resource = collections.all.products.first
  endif
-%}

<variant-picker
  data-product-id="{{ product_resource.id }}"
  data-product-url="{{ product_resource.url }}"
  data-template-product-match="true"
>

  {% render 'variant-main-picker', product_resource: product_resource %}

 

  <!-- Product JSON -->
  <script type="application/json">
    {{ product_resource | json }}
  </script>

</variant-picker>

{% javascript %}
document.addEventListener('variant:updated', function (event) {
  const variantId = event.detail.id;
  if (!variantId) return;

  const picker = document.querySelector('variant-picker');
  if (!picker) return;

  const jsonScript = picker.querySelector(
    'script[type="application/json"]'
  );
  if (!jsonScript) return;

  const product = JSON.parse(jsonScript.textContent);
  const variant = product.variants.find(
    v => String(v.id) === String(variantId)
  );

  if (!variant) return;

  const deliveryWrapper = document.querySelector('[data-expected-delivery]');
  if (!deliveryWrapper) return;

  const delivery =
    variant.metafields?.custom?.delivery_date || '3â€“5 working days';

  deliveryWrapper.innerHTML = `
    <p>
      <strong>Expected delivery:</strong>
      ${delivery}
    </p>
  `;
});
{% endjavascript %}

{% schema %}
{
  "name": "Product Variant Picker",
  "settings": [
    {
      "type": "select",
      "id": "variant_style",
      "label": "Variant Style",
      "options": [
        { "value": "buttons", "label": "Buttons" },
        { "value": "dropdowns", "label": "Dropdowns" }
      ],
      "default": "buttons"
    }
  ],
  "presets": [
    {
      "name": "Product Variant Picker",
      "category": "Product"
    }
  ]
}
{% endschema %}
