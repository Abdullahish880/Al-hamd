{% schema %}
{
  "name": "Premium Product Page",
  "settings": [
    { "type": "color", "id": "primary_color", "label": "Primary Color", "default": "#3f7f73" },
    { "type": "color", "id": "button_color", "label": "Add to Cart Button Color", "default": "#3f7f73" },
    { "type": "text", "id": "badge_text", "label": "Stock Badge Text", "default": "Back In Stock" },
    {
      "type": "text",
      "id": "discount_text",
      "label": "Discount / Offer Text",
      "default": "ðŸŽ‰ Get 20% OFF â€“ Limited Time Offer"
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Product Image",
      "settings": [{ "type": "image_picker", "id": "image", "label": "Image" }]
    },
    {
      "type": "bullet",
      "name": "Bullet Point",
      "settings": [{ "type": "text", "id": "bullet_text", "label": "Bullet Text" }]
    }
  ],
  "presets": [{ "name": "Premium Product Page", "category": "Products" }]
}
{% endschema %}

<style>
  :root {
    --primary: {{ section.settings.primary_color }};
    --btn: {{ section.settings.button_color }};
  }
  .custom-product { display: grid; grid-template-columns: 1.1fr 0.9fr; gap:50px; max-width:1200px; margin:auto; padding:40px 20px; }
  .gallery { display: flex; flex-direction: column; gap:15px; position:relative; }
  .main-image { position: relative; border-radius:10px; overflow:hidden; }
  .main-image img { width:100%; height:auto; display:block; border-radius:10px; }
  .thumbnails { display:flex; gap:10px; overflow-x:auto; padding:5px 0; }
  .thumbnails img { width:70px; height:70px; object-fit:cover; border-radius:6px; cursor:pointer; border:2px solid transparent; }
  .thumbnails img.active { border-color: var(--primary); }
  .product-info { display:flex; flex-direction:column; gap:18px; }
  .badge { background:#e5f3ef; color:var(--primary); padding:6px 12px; border-radius:20px; font-size:12px; width:fit-content; }
  h1 { font-size:34px; margin:0; }
  .subtitle { font-size:15px; color:#666; }
  .price { font-size:26px; font-weight:bold; }
  .discount { font-size:14px; font-weight:600; color:#d9534f; }
  .features li { margin-bottom:8px; }
  .variant-select { padding:12px; border-radius:8px; border:1px solid #ddd; font-size:14px; }
  .cart-row { display:flex; gap:15px; margin-top:10px; }
  .qty { display:flex; border:1px solid #ddd; border-radius:8px; overflow:hidden; }
  .qty button { width:40px; border:none; background:#fff; font-size:20px; cursor:pointer; }
  .qty input { width:50px; text-align:center; border:none; }
  .add-to-cart { flex:1; background:var(--btn); color:#fff; border:none; border-radius:10px; font-size:16px; cursor:pointer; }
  @media(max-width:900px){ .custom-product { grid-template-columns:1fr; } }
</style>

<div class="custom-product" data-section-id="{{ section.id }}">
  <div class="gallery">
    <div class="main-image">
      <img
        id="mainImage-{{ section.id }}"
        src="{{ product.featured_image | image_url: width:900, height:900 }}"
        width="900"
        height="900"
        alt="{{ product.title }}"
      >
      <button class="arrow left" style="position:absolute;top:50%;left:0;">â€¹</button>
      <button class="arrow right" style="position:absolute;top:50%;right:0;">â€º</button>
    </div>

    <div class="thumbnails">
      {% for block in section.blocks %}
        {% if block.type == 'image' and block.settings.image %}
          <img
            src="{{ block.settings.image | image_url: width:200, height:200 }}"
            width="200"
            height="200"
            data-large="{{ block.settings.image | image_url: width:900, height:900 }}"
            alt="{{ product.title }}"
            class="{% if forloop.first %}active{% endif %}"
            loading="lazy"
          >
        {% endif %}
      {% endfor %}
    </div>
  </div>

  <div class="product-info">
    <div class="rating">â˜…â˜…â˜…â˜…â˜… <span>132 reviews</span></div>
    <span class="badge">{{ section.settings.badge_text }}</span>
    <h1>{{ product.title }}</h1>
    <p class="subtitle">{{ product.description | strip_html | truncate: 120 }}</p>
    <div class="price">
      {{ product.price | money }}
      {% if product.compare_at_price > product.price -%}
        <span style="text-decoration:line-through;color:#999;font-size:16px;">
          {{- product.compare_at_price | money -}}
        </span>
      {%- endif %}
    </div>
    <div class="discount">{{ section.settings.discount_text }}</div>

    <ul class="features">
      {% for block in section.blocks %}
        {% if block.type == 'bullet' %}
          <li>{{ block.settings.bullet_text }}</li>
        {% endif %}
      {% endfor %}
    </ul>

    <form method="post" action="/cart/add">
      <select name="id" class="variant-select" id="variantSelect-{{ section.id }}">
        {% for variant in product.variants %}
          <option
            value="{{ variant.id }}"
            data-image="{{ variant.featured_image | default: product.featured_image | image_url: width:900 }}"
            {% if variant == product.selected_or_first_available_variant %}
              selected
            {% endif %}
          >
            {{ variant.title }}
          </option>
        {% endfor %}
      </select>

      <div class="cart-row">
        <div class="qty">
          <button type="button" class="minus">âˆ’</button>
          <input type="text" name="quantity" value="1" readonly>
          <button type="button" class="plus">+</button>
        </div>
        <button type="submit" class="add-to-cart">Add to Cart</button>
      </div>
    </form>
  </div>
</div>

<script>
  (function () {
    const section = document.querySelector('[data-section-id="{{ section.id }}"]');
    const mainImage = section.querySelector('#mainImage-{{ section.id }}');
    const thumbnails = section.querySelectorAll('.thumbnails img');
    thumbnails.forEach((img) =>
      img.addEventListener('click', () => {
        thumbnails.forEach((i) => i.classList.remove('active'));
        img.classList.add('active');
        mainImage.src = img.dataset.large;
      })
    );

    const variantSelect = section.querySelector('#variantSelect-{{ section.id }}');
    variantSelect.addEventListener('change', () => {
      const selected = variantSelect.selectedOptions[0];
      if (selected.dataset.image) mainImage.src = selected.dataset.image;
    });

    const qtyInput = section.querySelector('input[name="quantity"]');
    section.querySelector('.plus').onclick = () => qtyInput.value++;
    section.querySelector('.minus').onclick = () => {
      if (qtyInput.value > 1) qtyInput.value--;
    };

    // Thumbnail slider arrows
    const thumbWrapper = section.querySelector('.thumbnails');
    const btnLeft = section.querySelector('.arrow.left');
    const btnRight = section.querySelector('.arrow.right');
    btnLeft.onclick = () => thumbWrapper.scrollBy({ left: -80, behavior: 'smooth' });
    btnRight.onclick = () => thumbWrapper.scrollBy({ left: 80, behavior: 'smooth' });
  })();
</script>
