<section class="testimonial-section">
  <div class="testimonial-container">
    {% if section.settings.heading != blank %}
      <h2 class="testimonial-heading">{{ section.settings.heading }}</h2>
    {% endif %}

    {% if section.settings.subtitle != blank %}
      <p class="testimonial-subtitle">{{ section.settings.subtitle }}</p>
    {% endif %}

    <div class="testimonial-slider-wrapper">
      <!-- Slider -->
      <div class="testimonial-slider" id="testimonialSlider">
        {% for block in section.blocks %}
          <div
            class="testimonial-slide"
            style="background: {{ block.settings.card_bg_color }}; border:1px solid {{ block.settings.card_border_color }}"
          >
            {% if block.settings.photo %}
              <img
                src="{{ block.settings.photo | img_url: '200x200' }}"
                width="80"
                height="80"
                class="testimonial-photo"
                alt="{{ block.settings.name }}"
              >
            {% endif %}

            <p class="testimonial-text">“{{ block.settings.message }}”</p>
            <h3 class="testimonial-name">{{ block.settings.name }}</h3>

            {% if block.settings.role %}
              <p class="testimonial-role">{{ block.settings.role }}</p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Arrows -->
    <span class="arrow prev" onclick="moveLeft()">&#10094;</span>
    <span class="arrow next" onclick="moveRight()">&#10095;</span>

    <!-- Dots -->
    <div class="testimonial-dots">
      {% for block in section.blocks %}
        <span class="dot" onclick="currentSlide({{ forloop.index }})"></span>
      {% endfor %}
    </div>
  </div>
</section>

<style>
  /* ================================
   Banner-style Background
================================ */
  .testimonial-section {
    padding: 80px 20px;
    background: linear-gradient(to right, #e8f0ff, #ffffff);
    text-align: center;
  }

  /* ================================
   Layout
================================ */
  .testimonial-container {
    max-width: 900px;
    margin: auto;
    position: relative;
  }

  .testimonial-heading {
    font-size: clamp(26px, 4vw, 40px);
    font-weight: 700;
    margin-bottom: 10px;
  }

  .testimonial-subtitle {
    font-size: clamp(14px, 2vw, 18px);
    color: #666;
    margin-bottom: 30px;
  }

  /* Slider */
  .testimonial-slider-wrapper {
    position: relative;
    overflow: hidden;
  }

  .testimonial-slider {
    display: flex;
    transition: transform 0.5s ease;
    width: 100%;
  }

  .testimonial-slide {
    min-width: 100%;
    padding: 35px;
    border-radius: 14px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    box-sizing: border-box;
  }

  /* Slide Content */
  .testimonial-photo {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 15px;
  }

  .testimonial-text {
    font-size: clamp(16px, 2vw, 20px);
    font-style: italic;
    line-height: 1.6;
    margin-bottom: 18px;
  }

  .testimonial-name {
    font-size: 20px;
    font-weight: bold;
  }

  .testimonial-role {
    font-size: 14px;
    color: #777;
  }

  /* Dots */
  .testimonial-dots {
    margin-top: 20px;
  }

  .dot {
    height: 12px;
    width: 12px;
    background: #ccc;
    display: inline-block;
    border-radius: 50%;
    margin: 0 4px;
    cursor: pointer;
  }

  .dot.active {
    background: #000;
  }

  /* Arrows (desktop) */
  .arrow {
    cursor: pointer;
    position: absolute;
    top: 50%;
    font-size: 30px;
    padding: 18px;
    border-radius: 50%;
    background: white;
    transform: translateY(-50%);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    user-select: none;
    z-index: 10;
  }

  .prev {
    left: -70px;
  }
  .next {
    right: -70px;
  }

  /* ================================
   Tablet
================================ */
  @media (max-width: 900px) {
    .arrow {
      padding: 14px;
      font-size: 24px;
    }

    .prev {
      left: -40px;
    }
    .next {
      right: -40px;
    }
  }

  /* ================================
   Mobile
================================ */
  @media (max-width: 600px) {
    .arrow {
      padding: 12px;
      font-size: 20px;
      background: rgba(255, 255, 255, 0.9);
      display: block;
    }

    .prev {
      left: 10px;
    }
    .next {
      right: 10px;
    }

    .testimonial-slide {
      padding: 25px;
    }
  }

  /* XS phones */
  @media (max-width: 380px) {
    .testimonial-slide {
      padding: 20px;
    }
  }
</style>

<script>
let slideIndex = 0;
let slides = document.querySelectorAll(".testimonial-slide");
let totalSlides = slides.length;
let sliderWrapper = document.getElementById("testimonialSlider");
let autoSpeed = {{ section.settings.slider_speed | default: 5000 | json }};

/* Show slide */
function showSlides(i) {
  if (i >= totalSlides) slideIndex = 0;
  if (i < 0) slideIndex = totalSlides - 1;

  sliderWrapper.style.transform = `translateX(-${slideIndex * 100}%)`;

  let dots = document.querySelectorAll(".dot");
  dots.forEach(dot => dot.classList.remove("active"));
  dots[slideIndex].classList.add("active");
}

/* Arrows */
function moveLeft() {
  slideIndex--;
  showSlides(slideIndex);
}
function moveRight() {
  slideIndex++;
  showSlides(slideIndex);
}

/* Dots */
function currentSlide(n) {
  slideIndex = n - 1;
  showSlides(slideIndex);
}

/* Auto-play */
let autoPlay = setInterval(() => {
  slideIndex++;
  showSlides(slideIndex);
}, autoSpeed);

/* Pause on hover */
document.querySelector(".testimonial-slider-wrapper").addEventListener("mouseenter", () => {
  clearInterval(autoPlay);
});
document.querySelector(".testimonial-slider-wrapper").addEventListener("mouseleave", () => {
  autoPlay = setInterval(() => {
    slideIndex++;
    showSlides(slideIndex);
  }, autoSpeed);
});

/* Initialize */
showSlides(slideIndex);
</script>

{% schema %}
{
  "name": "Testimonial Section",
  "tag": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "What Our Customers Say" },
    { "type": "text", "id": "subtitle", "label": "Subtitle", "default": "Real testimonials from real customers" },
    { "type": "color", "id": "bg_color", "label": "Background Color", "default": "#ffffff" },
    {
      "type": "range",
      "id": "slider_speed",
      "label": "Slider Speed (ms)",
      "min": 2000,
      "max": 9000,
      "step": 500,
      "default": 5000
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial Item",
      "settings": [
        { "type": "image_picker", "id": "photo", "label": "Photo" },
        { "type": "text", "id": "name", "label": "Name", "default": "John Doe" },
        { "type": "text", "id": "role", "label": "Role", "default": "Verified Buyer" },
        {
          "type": "textarea",
          "id": "message",
          "label": "Message",
          "default": "This product is amazing! Highly recommended."
        },
        { "type": "color", "id": "card_bg_color", "label": "Card Background Color", "default": "#ffffff" },
        { "type": "color", "id": "card_border_color", "label": "Card Border Color", "default": "#ddd" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonial Section"
    }
  ]
}
{% endschema %}
