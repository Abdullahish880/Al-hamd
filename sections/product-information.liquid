{% liquid
  if section.settings.desktop_media_position == 'left'
    assign render_order = 'media,product-details'
  else
    assign render_order = 'product-details,media'
  endif

  assign product_has_media = true
  if closest.product.media.size == 0
    assign product_has_media = false
  endif

  assign product_grid_class = 'product-information__grid'

  if product_has_media == false
    assign product_grid_class = product_grid_class | append: ' product-information--media-none'
  elsif section.settings.desktop_media_position == 'right'
    assign product_grid_class = product_grid_class | append: ' product-information--media-right'
  else
    assign product_grid_class = product_grid_class | append: ' product-information--media-left'
  endif

  if section.settings.equal_columns
    assign product_grid_class = product_grid_class | append: ' product-information__grid--half'

    if section.settings.limit_details_width
      assign product_grid_class = product_grid_class | append: ' product-information__grid--limit-details'
    endif
  endif

  case section.settings.content_width
    when 'content-center-aligned'
      assign content_width = 'page-width'
    when 'content-full-width'
      assign content_width = 'full-width'
  endcase
%}

<script type="application/ld+json">
  {{ closest.product | structured_data }}
</script>

<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<div
  class="product-information section section--{{ content_width }} spacing-style color-{{ section.settings.color_scheme }} relative"
  style="{% render 'spacing-style', settings: section.settings %} --gap: {{ section.settings.gap }}px;"
>
  {% if section.settings.desktop_media_position == 'left' and product_has_media %}
    {% assign product_href = '#ProductInformation-' | append: section.id %}
    {% render 'skip-to-content-link', href: product_href, text: 'accessibility.skip_to_product_info' %}
  {% endif %}

  <div class="{{ product_grid_class }}" data-product-grid-content>
    {% assign render_order_array = render_order | split: ',' %}

    {% capture media %}
      <div class="product-information__media">
        {% content_for 'block',
          type: '_product-media-gallery',
          id: 'media-gallery',
          closest.product: closest.product
        %}
      </div>
    {% endcapture %}

    {% capture details %}
      {% content_for 'block',
        type: '_product-details',
        id: 'product-details',
        closest.product: closest.product
      %}

      <!-- COD BUTTON -->
      <button type="button" class="cod-button" id="OpenCODModal">
        Buy with Cash on Delivery
      </button>
    {% endcapture %}

    {% for block in render_order_array %}
      {% if block == 'media' and product_has_media %}
        {{ media }}
      {% elsif block == 'product-details' %}
        {{ details }}
      {% endif %}
    {% endfor %}
  </div>

  {% content_for 'blocks' %}
</div>

<!-- ================= COD MODAL ================= -->
<div id="CODModal" class="cod-modal">
  <div class="cod-modal__content">
    <button class="cod-close" id="CloseCODModal">Ã—</button>

    <h2>CASH ON DELIVERY</h2>

    <div class="cod-product">
      <img src="{{ closest.product.featured_image | image_url: width: 120 }}">
      <div>
        <strong>{{ closest.product.title }}</strong>
        <p>{{ closest.product.selected_or_first_available_variant.title }}</p>
        <p>{{ closest.product.price | money }}</p>
      </div>
    </div>

    <hr>

    <div class="cod-summary">
      <div><span>Subtotal</span><span>{{ closest.product.price | money }}</span></div>
      <div><span>Shipping</span><span>Free</span></div>
      <div class="cod-total">
        <span>Total</span>
        <span>{{ closest.product.price | money }}</span>
      </div>
    </div>

    <p><strong>Shipping method:</strong> Free shipping</p>

    <form id="CODForm">
      <input required placeholder="First name*">
      <input required placeholder="Phone number*" value="+966">
      <input required placeholder="Full Address*">
      <input required placeholder="City*">
      <input type="email" placeholder="Email">

      <label class="checkbox">
        <input type="checkbox">
        Subscribe to stay updated with new products and offers!
      </label>

      <label class="checkbox">
        <input type="checkbox">
        Add Shipping Protection for just <strong>9.99 SR</strong>
      </label>

      <label class="checkbox">
        <input type="checkbox">
        Add Special Mystery Product for just <strong>20.00 SR</strong>
      </label>

      <button type="submit" class="cod-submit">
        Buy with Cash on Delivery
      </button>
    </form>
  </div>
</div>

{% stylesheet %}
.cod-button {
  width: 100%;
  padding: 14px;
  background: #000;
  color: #fff;
  border: none;
  margin-top: 12px;
  cursor: pointer;
  font-weight: 600;
}

.cod-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
  z-index: 9999;
}

.cod-modal__content {
  background: #fff;
  max-width: 520px;
  margin: 5% auto;
  padding: 20px;
  position: relative;
}

.cod-close {
  position: absolute;
  top: 10px;
  right: 14px;
  font-size: 22px;
  background: none;
  border: none;
  cursor: pointer;
}

.cod-product {
  display: flex;
  gap: 12px;
}

.cod-product img {
  width: 80px;
}

.cod-summary div {
  display: flex;
  justify-content: space-between;
  margin: 6px 0;
}

.cod-total {
  font-weight: bold;
}

#CODForm input {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
}

.checkbox {
  display: block;
  margin: 10px 0;
}

.cod-submit {
  width: 100%;
  padding: 14px;
  background: #2e7d32;
  color: #fff;
  border: none;
  font-weight: 600;
  cursor: pointer;
}
{% endstylesheet %}

<script>
document.addEventListener('DOMContentLoaded', function () {
  const modal = document.getElementById('CODModal');
  const openBtn = document.getElementById('OpenCODModal');
  const closeBtn = document.getElementById('CloseCODModal');

  openBtn.addEventListener('click', () => modal.style.display = 'block');
  closeBtn.addEventListener('click', () => modal.style.display = 'none');

  window.addEventListener('click', e => {
    if (e.target === modal) modal.style.display = 'none';
  });
});
</script>

{% schema %}
{
  "name": "t:names.product_information",
  "blocks": [
    { "type": "@app" }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    { "type": "header", "content": "t:content.layout" },
    {
      "type": "select",
      "id": "content_width",
      "label": "t:settings.width",
      "options": [
        { "value": "content-center-aligned", "label": "t:options.page" },
        { "value": "content-full-width", "label": "t:options.full" }
      ],
      "default": "content-center-aligned"
    },
    {
      "type": "select",
      "id": "desktop_media_position",
      "label": "t:settings.media_position",
      "options": [
        { "value": "left", "label": "t:options.left" },
        { "value": "right", "label": "t:options.right" }
      ],
      "default": "left"
    },
    { "type": "checkbox", "id": "equal_columns", "label": "t:settings.equal_columns", "default": false },
    { "type": "range", "id": "gap", "label": "t:settings.gap", "min": 0, "max": 48, "step": 4, "unit": "px", "default": 16 }
  ],
  "presets": []
}
{% endschema %}
